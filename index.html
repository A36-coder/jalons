<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Rechercher par Lot et Jalon</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      padding: 20px;
      background-color: #f8f9fa;
    }
    .container {
      max-width: 1200px;
      margin: auto;
    }
    #results {
      margin-top: 20px;
    }
    #loadingMsg {
      font-style: italic;
      color: #666;
    }
    #exeFilterContainer {
      display: none;
    }
  </style>
</head>
<body>
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-4">
    <div class="container-fluid">
      <a class="navbar-brand" href="#">üìä Mon Site</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav">
          <li class="nav-item"><a class="nav-link active" href="index.html">üè† Accueil</a></li>
          <li class="nav-item"><a class="nav-link" href="generate.html">üõ† G√©n√©rer JSON</a></li>
        </ul>
      </div>
    </div>
  </nav>
  <div class="container">
    <h1>Rechercher par Lot et Jalon</h1>
    <div class="row g-3">
      <div class="col-md-4">
        <label for="lotInput" class="form-label">Lot</label>
        <input type="text" class="form-control" id="lotInput" placeholder="Entrez le lot">
      </div>
      <div class="col-md-3">
        <label for="jalonInput" class="form-label">Jalon</label>
        <input type="text" class="form-control" id="jalonInput" placeholder="Entrez le jalon">
      </div>
      <div class="col-md-2 d-flex align-items-end">
        <div class="form-check">
          <input class="form-check-input" type="checkbox" id="filterVA">
          <label class="form-check-label" for="filterVA">
            Filtrer v%A inf√©rieur √† 100
          </label>
        </div>
      </div>
    </div>
    <button id="searchButton" class="btn btn-primary mt-3">Rechercher</button>
    <div id="exeFilterContainer" class="mt-3">
      <label for="exeFilter" class="form-label">Filtrer par Exe</label>
      <select class="form-select" id="exeFilter">
        <option value="">Tous</option>
      </select>
    </div>
    <div id="loadingMsg"></div>
    <div id="results" class="mt-4">
      <!-- Les r√©sultats seront affich√©s ici -->
    </div>
  </div>

  <script>
    let filteredData = [];

    document.getElementById('searchButton').addEventListener('click', function() {
      const lot = document.getElementById('lotInput').value;
      const jalon = document.getElementById('jalonInput').value;
      const filterVA = document.getElementById('filterVA').checked;

      const loadingMsg = document.getElementById('loadingMsg');
      loadingMsg.textContent = "Chargement en cours...";

      fetch('details_jalons.json')
        .then(response => response.json())
        .then(data => {
          let results = data;

          if (lot) {
            results = results.filter(item => item.Ident == lot);
          }

          if (jalon) {
            results = results.filter(item => item.Jalon == jalon);
          }

          if (filterVA) {
            results = results.filter(item => item['v%A'] < 100);
          }

          filteredData = results;
          populateExeFilter(results);
          displayResults(results);
          loadingMsg.textContent = "";
        })
        .catch(error => {
          console.error('Erreur lors du chargement du fichier JSON:', error);
          loadingMsg.textContent = "Erreur lors du chargement des donn√©es.";
        });
    });

    document.getElementById('exeFilter').addEventListener('change', function() {
      const exeFilter = document.getElementById('exeFilter').value;
      let results = filteredData;

      if (exeFilter) {
        results = results.filter(item => item.Exe == exeFilter);
      }

      displayResults(results);
    });

    function populateExeFilter(data) {
      const exeFilterContainer = document.getElementById('exeFilterContainer');
      const exeFilter = document.getElementById('exeFilter');
      const uniqueExeValues = [...new Set(data.map(item => item.Exe))].filter(Boolean);

      exeFilter.innerHTML = '<option value="">Tous</option>';
      uniqueExeValues.forEach(value => {
        const option = document.createElement('option');
        option.value = value;
        option.textContent = value;
        exeFilter.appendChild(option);
      });

      if (uniqueExeValues.length > 0) {
        exeFilterContainer.style.display = 'block';
      } else {
        exeFilterContainer.style.display = 'none';
      }
    }

    function displayResults(results) {
      const resultsDiv = document.getElementById('results');
      if (results.length === 0) {
        resultsDiv.innerHTML = '<p>Aucun r√©sultat trouv√©.</p>';
        return;
      }

      let tableHTML = `
        <table class="table table-striped">
          <thead>
            <tr>
              <th>Jalon</th>
              <th>Lot</th>
              <th>Budget</th>
              <th>Exe</th>
              <th>Libell√© Activit√©</th>
              <th>R√©seau/OT</th>
              <th>RRO</th>
              <th>TR</th>
              <th>v%A</th>
              <th>Date FTard</th>
            </tr>
          </thead>
          <tbody>
      `;

      results.forEach(result => {
        tableHTML += `
          <tr>
            <td>${result.Jalon !== undefined ? result.Jalon : ''}</td>
            <td>${result.Ident !== undefined ? result.Ident : ''}</td>
            <td>${result.Budget !== undefined ? result.Budget : ''}</td>
            <td>${result.Exe !== undefined ? result.Exe : ''}</td>
            <td>${result['Libell√© Activit√©'] !== undefined ? result['Libell√© Activit√©'] : ''}</td>
            <td>${result['R√©seau/OT'] !== undefined ? result['R√©seau/OT'] : ''}</td>
            <td>${result.RRO !== undefined ? result.RRO : ''}</td>
            <td>${result.TR !== undefined ? result.TR : ''}</td>
            <td>${result['v%A'] !== undefined ? result['v%A'] : ''}</td>
            <td>${result['Date FTard'] !== undefined ? result['Date FTard'] : ''}</td>
          </tr>
        `;
      });

      tableHTML += `</tbody></table>`;
      resultsDiv.innerHTML = tableHTML;
    }
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
